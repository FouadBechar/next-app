#!/usr/bin/env node
import fs from 'fs'
import path from 'path'
import browserslist from 'browserslist'

async function main() {
  try {
    // Resolve browserslist for the current project (reads package.json or .browserslistrc)
    const list = browserslist(undefined, { path: process.cwd() })
    const outDir = path.join(process.cwd(), 'lib')
    const outPath = path.join(outDir, 'generated-browsers.ts')
    const content = `// Generated by scripts/generate-browsers.mjs â€” do not edit\n` +
      `const browsers = ${JSON.stringify(list, null, 2)} as string[];\n\nexport default browsers;\n`

    fs.mkdirSync(outDir, { recursive: true })
    fs.writeFileSync(outPath, content, 'utf8')
    console.log('Wrote', outPath)
  } catch (err) {
    console.error('Failed to generate browsers list:', err)
    process.exit(1)
  }
}

main()
